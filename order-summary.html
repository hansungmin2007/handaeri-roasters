<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì£¼ë¬¸ ìš”ì•½ - í•œëŒ€ë¦¬ ë¡œí„°ìŠ¤</title>
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

  <!-- í—¤ë” -->
  <header class="header">
    <h1><a href="index.html" class="logo">í•œëŒ€ë¦¬ ë¡œí„°ìŠ¤</a></h1>
  </header>

  <!-- ë©”ì¸ -->
  <main class="hero">
    <h2>ì£¼ë¬¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h2>

    <div id="order-summary" style="max-width: 600px; margin: 2rem auto; text-align: left;">
      <!-- ğŸ›’ ì£¼ë¬¸ ë‚´ì—­ -->
      <h3>ğŸ›’ ì£¼ë¬¸ ë‚´ì—­</h3>
      <ul id="order-list" style="list-style: none; padding-left: 0;"></ul>

      <!-- ğŸ“¦ ë°°ì†¡ ì •ë³´ ì…ë ¥ -->
      <h3 style="margin-top: 2rem;">ğŸ“¦ ë°°ì†¡ ì •ë³´</h3>
      <form id="shipping-form">
        <label>ì´ë¦„<br>
          <input type="text" id="name" required />
        </label><br><br>
        <label>ì£¼ì†Œ<br>
          <input type="text" id="address" required />
        </label><br><br>
        <label>ì—°ë½ì²˜<br>
          <input type="text" id="phone" required />
        </label><br><br>
      </form>

      <!-- ë²„íŠ¼ -->
      <div style="margin-top: 2rem; display: flex; gap: 1rem;">
        <button onclick="downloadPDF()">PDF ì €ì¥</button>
        <a href="index.html"><button>í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button></a>
      </div>
    </div>
  </main>

  <!-- í‘¸í„° -->
  <footer class="footer">
    &copy; 2025 í•œëŒ€ë¦¬ ë¡œí„°ìŠ¤
  </footer>

  <!-- âœ… ì£¼ë¬¸ ì²˜ë¦¬ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    const orderData = JSON.parse(localStorage.getItem("order") || "[]");
    const orderList = document.getElementById("order-list");

    // ì£¼ë¬¸ í•­ëª© ì¶œë ¥
    if (orderData.length > 0) {
      orderData.forEach(item => {
        const li = document.createElement("li");
        li.textContent = `${item.name} - ${item.qty}ê°œ`;
        orderList.appendChild(li);
      });
    } else {
      orderList.innerHTML = "<li>ì£¼ë¬¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</li>";
    }

    // ì´ì „ ë°°ì†¡ ì •ë³´ ìë™ ì±„ì›€
    const savedShipping = JSON.parse(localStorage.getItem("shipping") || "{}");
    if (savedShipping.name) document.getElementById("name").value = savedShipping.name;
    if (savedShipping.address) document.getElementById("address").value = savedShipping.address;
    if (savedShipping.phone) document.getElementById("phone").value = savedShipping.phone;

    // PDF ì €ì¥ + ë°°ì†¡ ì •ë³´ ì €ì¥ + ì£¼ë¬¸ ë‚´ì—­ ì „ì²´ ì €ì¥
    async function downloadPDF() {
      const name = document.getElementById("name").value.trim();
      const address = document.getElementById("address").value.trim();
      const phone = document.getElementById("phone").value.trim();

      if (!name || !address || !phone) {
        alert("ë°°ì†¡ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      // ë°°ì†¡ ì •ë³´ ì €ì¥
      const shippingInfo = { name, address, phone };
      localStorage.setItem("shipping", JSON.stringify(shippingInfo));

      // ê´€ë¦¬ììš© ì£¼ë¬¸ ì „ì²´ ì €ì¥
      const newOrder = {
        id: Date.now(),
        items: orderData,
        customer: shippingInfo,
        status: "ë°°ì†¡ ì¤€ë¹„ì¤‘"
      };
      const allOrders = JSON.parse(localStorage.getItem("allOrders") || "[]");
      allOrders.push(newOrder);
      localStorage.setItem("allOrders", JSON.stringify(allOrders));

      // PDF ë‹¤ìš´ë¡œë“œ
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFont("Helvetica", "normal");
      doc.setFontSize(14);
      doc.text("ğŸ“¦ ì£¼ë¬¸ ìš”ì•½ì„œ - í•œëŒ€ë¦¬ ë¡œí„°ìŠ¤", 20, 20);

      doc.text(`ì´ë¦„: ${name}`, 20, 40);
      doc.text(`ì£¼ì†Œ: ${address}`, 20, 50);
      doc.text(`ì—°ë½ì²˜: ${phone}`, 20, 60);

      doc.text("ğŸ›’ ì£¼ë¬¸ ë‚´ì—­:", 20, 80);

      let y = 90;
      orderData.forEach(item => {
        doc.text(`- ${item.name} x ${item.qty}`, 20, y);
        y += 10;
      });

      doc.save("order-summary.pdf");
    }
  </script>
</body>
</html>
